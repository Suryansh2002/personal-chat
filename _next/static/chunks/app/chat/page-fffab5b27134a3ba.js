(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{2099:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});let a=(0,r(2354).UU)("https://keifbefjotjjtryynuec.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlaWZiZWZqb3RqanRyeXludWVjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4MTAzMDYsImV4cCI6MjA2MzM4NjMwNn0.VTsJpSdIgiOYDku7Xqee4ayRq5V8rpbusdKzyWk21qQ")},3170:(e,t,r)=>{Promise.resolve().then(r.bind(r,8811))},4186:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var a=r(2099),s=r(2115);function n(){let[e,t]=(0,s.useState)(null),[r,n]=(0,s.useState)(!0),[l,o]=(0,s.useState)(null);return(0,s.useEffect)(()=>{a.N.auth.getSession().then(e=>{let{data:{session:r},error:a}=e;t(r),n(!1),o(a?a.message:null)});let{data:e}=a.N.auth.onAuthStateChange((e,r)=>{t(r)});return()=>{null==e||e.subscription.unsubscribe()}},[]),{session:e,error:l,loading:r}}},8811:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>C});var a=r(5155),s=r(2115),n=r(429);function l(e){let{onSend:t,disabled:r}=e,[l,o]=(0,s.useState)(""),d=(0,s.useRef)(null);return(0,a.jsx)("div",{className:"fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-2xl px-4 pb-6 z-20",children:(0,a.jsxs)("div",{className:"flex items-end gap-2 bg-gray-900 border border-gray-700 rounded-2xl shadow-lg p-3",children:[(0,a.jsx)("textarea",{ref:d,className:"flex-1 resize-none bg-transparent outline-none text-white placeholder-gray-400 p-2 min-h-[40px] max-h-40 text-base",rows:1,value:l,onChange:e=>{o(e.target.value),d.current&&(d.current.style.height="auto",d.current.style.height=d.current.scrollHeight+"px")},placeholder:"Type your message...",disabled:r}),(0,a.jsx)("button",{onClick:()=>{l.trim()&&(null==t||t(l.trim()),o(""),d.current&&(d.current.style.height="auto"))},disabled:!l.trim()||r,className:"bg-indigo-700 hover:bg-indigo-800 disabled:bg-gray-700 text-white font-semibold px-4 py-2 rounded-xl transition-colors shadow-md",children:(0,a.jsx)(n.A,{className:"w-5 h-5"})})]})})}var o=r(2099),d=r(1368),i=r(4186),u=r(5695),c=r(8240),m=r(4823);function x(e){let{content:t}=e;return(0,a.jsx)("div",{className:"prose max-w-none",children:(0,a.jsx)(c.oz,{remarkPlugins:[m.A],children:t})})}var f=r(6671);let h=[];function p(){let[e,t]=(0,s.useState)(h),[r,n]=(0,s.useState)(!1),c=(0,s.useRef)(null),{session:m,loading:p}=(0,i.A)(),b=(0,u.useRouter)(),g=(0,u.useSearchParams)(),[j,y]=(0,s.useState)(null);g.get("id")!==j&&y(g.get("id"));let v=new URLSearchParams(g.toString());(0,s.useEffect)(()=>{if(!p){if(!j)return void t([]);(async()=>{let{data:e,error:r}=await o.N.from("chat").select("*").eq("chat_id",j).order("created_at",{ascending:!0});if(r)return console.error(r);t((null==e?void 0:e.map(e=>({id:e.id,content:e.content,role:e.role})))||[])})()}},[j,p]),(0,s.useEffect)(()=>{if(!p&&!m)return void b.push("/")},[p,m,b]),(0,s.useEffect)(()=>{var e;null==(e=c.current)||e.scrollIntoView({behavior:"smooth"})},[e]);let w=async r=>{if(!r.trim())return;n(!0);let a=j||(0,d.A)(),s=[...e,{id:(0,d.A)(),content:r,role:"user"}];t(s),o.N.functions.invoke("ai",{body:{chat_id:a,content:r,prevMessages:e}}).then(e=>{if(e.data.error)return void f.oR.error(e.data.error);s.push(e.data),t(s)}).catch(e=>console.error(e)).finally(()=>{n(!1),j!==a&&(v.set("id",a),b.replace("?".concat(v.toString())))})};return(0,a.jsxs)("div",{className:"flex flex-col w-full max-w-4xl pt-3 pb-32 px-2 md:px-0",children:[e.map(e=>(0,a.jsx)("div",{className:"flex w-full mb-3 ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsx)("div",{className:"rounded-2xl px-4 py-2 max-w-[80%] text-base break-words shadow-md ".concat("user"===e.role?"bg-teal-300/30 text-gray-200 rounded-bl-md border border-gray-700":"bg-blue-300/10 text-gray-200 rounded-br-md"),children:(0,a.jsx)(x,{content:e.content})})},e.id)),r&&(0,a.jsx)("div",{className:"flex w-full mb-3 justify-start",children:(0,a.jsx)("div",{className:"rounded-2xl px-4 py-2 max-w-[80%] text-base bg-gray-800 text-gray-400 border border-gray-700 animate-pulse",children:"AI is typing..."})}),(0,a.jsx)("div",{ref:c,className:"pt-24"}),(0,a.jsx)(l,{onSend:w,disabled:r})]})}var b=r(4011),g=r(9434);function j(e){let{className:t,...r}=e;return(0,a.jsx)(b.bL,{"data-slot":"avatar",className:(0,g.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",t),...r})}function y(e){let{className:t,...r}=e;return(0,a.jsx)(b.H4,{"data-slot":"avatar-fallback",className:(0,g.cn)("bg-muted flex size-full items-center justify-center rounded-full",t),...r})}var v=r(8279);function w(e){let{...t}=e;return(0,a.jsx)(v.bL,{"data-slot":"dropdown-menu",...t})}function N(e){let{...t}=e;return(0,a.jsx)(v.l9,{"data-slot":"dropdown-menu-trigger",...t})}function I(e){let{className:t,sideOffset:r=4,...s}=e;return(0,a.jsx)(v.ZL,{children:(0,a.jsx)(v.UC,{"data-slot":"dropdown-menu-content",sideOffset:r,className:(0,g.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...s})})}function S(e){let{className:t,inset:r,...s}=e;return(0,a.jsx)(v.JU,{"data-slot":"dropdown-menu-label","data-inset":r,className:(0,g.cn)("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",t),...s})}function k(e){let{className:t,...r}=e;return(0,a.jsx)(v.wv,{"data-slot":"dropdown-menu-separator",className:(0,g.cn)("bg-border -mx-1 my-1 h-px",t),...r})}function z(){let{session:e,loading:t}=(0,i.A)(),r=(0,u.useRouter)();return((0,s.useEffect)(()=>{!t&&(e||r.push("/"))},[t,e,r]),e)?(0,a.jsxs)(w,{children:[(0,a.jsx)(N,{className:"fixed top-0 right-0 m-2 p-2",children:(0,a.jsx)(j,{className:"w-10 h-10",children:(0,a.jsx)(y,{className:"bg-gradient-to-br from-blue-800 to-purple-800 text-white font-bold",children:e.user.user_metadata.display_name.charAt()})})}),(0,a.jsxs)(I,{className:"w-56 bg-gray-950 text-gray-100 mr-4 border border-gray-800",children:[(0,a.jsx)(S,{className:"text-base font-semibold text-blue-400",children:e.user.user_metadata.display_name}),(0,a.jsx)("p",{className:"text-xs p-2 text-gray-400 break-all",children:e.user.email}),(0,a.jsx)(k,{className:"bg-gray-800"}),(0,a.jsx)("div",{className:"p-3",children:(0,a.jsx)("button",{onClick:()=>{o.N.auth.signOut().then(()=>{f.oR.success("Logged out successfully")})},className:"w-full text-left text-sm text-red-400 hover:text-red-300 hover:bg-gray-900 p-2 rounded-md transition-colors font-semibold",children:"Logout"})})]})]}):(0,a.jsx)(a.Fragment,{})}var A=r(4940);function _(){let e=(0,u.useRouter)();return(0,a.jsx)("button",{onClick:()=>{e.push("/chat")},className:"fixed m-2 p-2 text-gray-400 hover:text-gray-100 transition-colors top-0 left-0 bg-gray-800 rounded-lg",children:(0,a.jsx)(A.A,{className:"w-7 h-7"})})}function C(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("nav",{children:[(0,a.jsx)(_,{}),(0,a.jsx)(z,{})]}),(0,a.jsx)("div",{className:"w-full pt-16 h-[calc(100vh-60px)] flex justify-center overflow-y-auto no-scrollbar",children:(0,a.jsx)(s.Suspense,{children:(0,a.jsx)(p,{})})})]})}},9434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var a=r(2596),s=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[671,911,22,441,684,358],()=>t(3170)),_N_E=e.O()}]);